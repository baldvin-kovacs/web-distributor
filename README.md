# Web-Distributor 

This script provides a solution to the following problem. You have one public
ip address, and multiple webservers on your LAN that you want to use with
different domains. Especially, if you regularly want to deploy new domains with
new webservers.

This script only generates configuration files. For now, it generates nginx
configuration files, and configuration files for
[acme-redirect](https://github.com/kpcyrd/acme-redirect). 

## Installation

Configure `acme-redirect` with `nginx` by following their guides.

Include the configuration files generated by `web-distributor` to `nginx`. When using the default
paths, adding the line `include /etc/web-distributor/nginx/*` to your nginx.conf.

When you run `web-distributor` the first time, it generates a home directory in `/etc/web-distributor`.

To configure `web-distributor`, edit `/etc/web-distributor/config.toml`. Recognized options:

- `home`: Path for the webserver configuration files. Defaults to `/etc/web-distributor`.
- `acme_redirect_configs`: Path for `acme-redirect` configuration files. Defaults to `/etc/acme-redirect.d`.
- `[routes]`: A list of your desired reverse proxies, separated by a linebreak. "example.com" = "127.0.0.1" would be a correct syntax.
- `[login_groups]`: Defines which domain belongs to which login group. For each login group there will be a `.htaccess` file generated.
  Using the `web-distributor login-group` subcommand, logins (name, password pairs) can be added to login groups.

It is not needed to edit the config file manually now. It stays supported,
however now there is the option to use the different subcommands to manage
routes and logins. Run `web-distributor --help` for more documentation.

You can also specify a different path for the configuration file like this:
`web-distributor -c config-file`.

Every time you run this script with a new configuration, run `acme-redirect
renew` afterwards. Depending on how you configured `acme-redirect`, also run
`systemctl reload nginx`.

## Usage

To add a new domain, ensure that your DNS entry points to the installed system,
and then simply run

```
web-distributor add new-domain.net server-address
acme-redirect renew
systemctl reload nginx
```



